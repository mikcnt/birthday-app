<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Birthday Surprise</title>
    <style>
        :root {
            --bg1: #0f1020;
            --bg2: #1b2a49;
            --card: rgba(255, 255, 255, 0.08);
            --text: rgba(255, 255, 255, 0.92);
            --muted: rgba(255, 255, 255, 0.7);
            --yes: #4ade80;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color: var(--text);
            min-height: 100vh;
            display: grid;
            place-items: center;
            background: radial-gradient(1200px 600px at 20% 10%, #2a3a7a 0%, transparent 60%),
            radial-gradient(1000px 700px at 80% 90%, #0ea5e9 0%, transparent 55%),
            linear-gradient(135deg, var(--bg1), var(--bg2));
            overflow: hidden;
        }

        .card {
            width: min(560px, calc(100vw - 32px));
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 20px;
            padding: 22px 18px;
            box-shadow: 0 20px 80px rgba(0, 0, 0, 0.45);
            backdrop-filter: blur(10px);
            position: relative;
        }

        h1 {
            font-size: 24px;
            margin: 0 0 8px 0;
            letter-spacing: 0.2px;
        }

        p {
            margin: 0 0 16px 0;
            color: var(--muted);
            line-height: 1.35;
            font-size: 15px;
            min-height: 40px;
        }

        .stage {
            position: relative;
            height: 240px;
            border-radius: 16px;
            border: 1px dashed rgba(255, 255, 255, 0.18);
            background: rgba(0, 0, 0, 0.12);
            overflow: hidden;
        }

        .buttons {
            position: absolute;
            inset: 0;
        }

        button {
            appearance: none;
            border: none;
            border-radius: 999px;
            padding: 14px 18px;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.35);
            transform: translateZ(0);
            transition: transform 180ms ease;
        }

        #yesBtn {
            position: absolute;
            background: var(--yes);
            color: #0b1220;
            touch-action: none; /* prevents scroll while holding */
        }

        #yesBtn.neutral {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.85);
        }

        #yesBtn.smooth {
            transition: left 280ms ease, top 280ms ease, background-color 280ms ease,
            color 280ms ease, transform 180ms ease;
        }

        .progress {
            height: 10px;
            border-radius: 999px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-top: 12px;
            display: none;
        }

        .progress > div {
            height: 100%;
            width: 0%;
            background: rgba(255, 255, 255, 0.55);
        }

        .small {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.55);
            margin-top: 12px;
        }
    </style>
</head>

<body>
<div class="card">
    <h1 id="title">Birthday mission ðŸŽ‚</h1>
    <p id="subtitle">Are you ready to know where we are going?</p>

    <div class="stage" id="stage">
        <div class="buttons">
            <button id="yesBtn">HOLD YES ðŸ˜„</button>
        </div>
    </div>

    <div class="progress" id="progress"><div></div></div>

</div>

<script>
    const stage = document.getElementById("stage");
    const yesBtn = document.getElementById("yesBtn");
    const subtitle = document.getElementById("subtitle");

    const progressWrap = document.getElementById("progress");
    const progressBar = progressWrap.querySelector("div");

    function clamp(n, min, max) {
        return Math.max(min, Math.min(max, n));
    }

    function lerp(a, b, t) {
        return a + (b - a) * t;
    }

    function smoothstep(t) {
        return t * t * (3 - 2 * t);
    }

    function stageRect() {
        return stage.getBoundingClientRect();
    }

    function setYesPosition(x, y) {
        const rect = stageRect();
        const b = yesBtn.getBoundingClientRect();

        const nx = clamp(x, 8, rect.width - b.width - 8);
        const ny = clamp(y, 8, rect.height - b.height - 8);

        yesBtn.style.left = nx + "px";
        yesBtn.style.top = ny + "px";
    }

    function getYesPos() {
        return { x: yesBtn.offsetLeft, y: yesBtn.offsetTop };
    }

    function centerYesButton() {
        const rect = stageRect();
        const b = yesBtn.getBoundingClientRect();
        setYesPosition(Math.round((rect.width - b.width) / 2), Math.round((rect.height - b.height) / 2));
    }

    // Trial 1 state
    let holding = false;
    let trialEnded = false;
    let nextTrialReady = false;
    let holdStartMs = 0;
    let rafId = null;
    let nextTrialTimer = null;

    // Motion base
    let baseX = 0;
    let baseY = 0;

    function startTrial1() {
        subtitle.textContent = "Trial 1: press and hold YES for 30 seconds.";
        progressWrap.style.display = "block";
        progressBar.style.width = "0%";

        yesBtn.textContent = "HOLD YES ðŸ˜„";
        yesBtn.classList.remove("neutral");
        yesBtn.classList.remove("smooth");
        trialEnded = false;
        nextTrialReady = false;
        if (nextTrialTimer) {
            clearTimeout(nextTrialTimer);
            nextTrialTimer = null;
        }
        centerYesButton();
    }

    function failTrial1() {
        holding = false;
        cancelAnimationFrame(rafId);
        rafId = null;

        yesBtn.style.transform = "scale(1)";
        yesBtn.textContent = "You can let go now";
        yesBtn.classList.add("neutral");
        yesBtn.classList.add("smooth");
        centerYesButton();
        progressBar.style.width = "100%";

        subtitle.textContent =
            "Well... you didn't make it. Do you even care about this?! Nevermind, let's try something else...";

        if (navigator.vibrate) navigator.vibrate([50, 80, 50]);
        trialEnded = true;
        nextTrialReady = false;

        nextTrialTimer = setTimeout(() => {
            yesBtn.textContent = "Go to next trial";
            nextTrialReady = true;
        }, 3500);
    }

    // Motion curve per phase
    function motionAt(t) {
        // t in seconds since hold started, expected 0..30
        const rect = stageRect();

        // 0-10s: still
        if (t < 10) {
            return { x: baseX, y: baseY };
        }

        // Helper
        const twoPi = Math.PI * 2;
        const sin = Math.sin;

        const phase1 = (time) => {
            const p = clamp((time - 10) / 5, 0, 1);
            const amp = 30 + 30 * p; // 30..60 px
            const speed = 0.35 + 0.4 * p; // 0.35..0.75
            return {
                x: baseX + amp * sin(twoPi * speed * (time - 10)),
                y: baseY,
            };
        };

        const phase2 = (time) => {
            const p = clamp((time - 15) / 5, 0, 1);
            const amp = 70 + 45 * p; // 70..115
            const speed = 1.0 + 1.2 * p; // 1.0..2.2
            return {
                x: baseX + amp * sin(twoPi * speed * (time - 10)),
                y: baseY,
            };
        };

        const phase3 = (time) => {
            const p = clamp((time - 20) / 5, 0, 1);
            const ampY = 60 + 60 * p; // 60..120
            const speedY = 1.3 + 1.3 * p; // 1.3..2.6
            const ampX = 35 + 35 * p;
            const speedX = 1.8 + 1.2 * p;
            return {
                x: baseX + ampX * sin(twoPi * speedX * (time - 10)),
                y: baseY + ampY * sin(twoPi * speedY * (time - 10)),
            };
        };

        const phase4 = (time) => {
            const p = clamp((time - 25) / 5, 0, 1);
            const amp = 140 + 120 * p; // 140..260
            const speed1 = 3.0 + 3.0 * p; // 3..6
            const speed2 = 4.0 + 4.0 * p; // 4..8
            return {
                x:
                    baseX +
                    amp * 0.55 * sin(twoPi * speed1 * (time - 10)) +
                    amp * 0.35 * sin(twoPi * (speed2 * 0.9) * (time - 10) + 1.2) +
                    (Math.random() * 18 - 9) * (0.2 + 0.8 * p),
                y:
                    baseY +
                    amp * 0.45 * sin(twoPi * (speed1 * 1.1) * (time - 10) + 0.7) +
                    amp * 0.40 * sin(twoPi * speed2 * (time - 10) + 2.3) +
                    (Math.random() * 18 - 9) * (0.2 + 0.8 * p),
            };
        };

        const blendWindow = 0.7;
        const blend = (from, to, time, start) => {
            const u = smoothstep(clamp((time - start) / blendWindow, 0, 1));
            return { x: lerp(from.x, to.x, u), y: lerp(from.y, to.y, u) };
        };

        let pos;
        if (t < 15) {
            pos = phase1(t);
        } else if (t < 15 + blendWindow) {
            pos = blend(phase1(t), phase2(t), t, 15);
        } else if (t < 20) {
            pos = phase2(t);
        } else if (t < 20 + blendWindow) {
            pos = blend(phase2(t), phase3(t), t, 20);
        } else if (t < 25) {
            pos = phase3(t);
        } else if (t < 25 + blendWindow) {
            pos = blend(phase3(t), phase4(t), t, 25);
        } else {
            pos = phase4(t);
        }

        let x = pos.x;
        let y = pos.y;

        // Clamp within stage bounds
        const b = yesBtn.getBoundingClientRect();
        const maxX = rect.width - b.width - 8;
        const maxY = rect.height - b.height - 8;

        x = clamp(x, 8, maxX);
        y = clamp(y, 8, maxY);

        return { x, y };
    }

    function tickTrial1() {
        if (!holding) return;

        const now = performance.now();
        const elapsedMs = now - holdStartMs;
        const elapsedS = elapsedMs / 1000;

        // Update progress
        const pct = clamp((elapsedS / 30) * 100, 0, 100);
        progressBar.style.width = pct.toFixed(1) + "%";

        // Update subtitle at key moments
        if (elapsedS < 10) {
            subtitle.textContent = "Ok. Just hold it... 30 seconds.";
        } else if (elapsedS < 15) {
            subtitle.textContent = "Oh! It moved. Keep holding.";
        } else if (elapsedS < 20) {
            subtitle.textContent = "It is getting faster ðŸ˜ˆ";
        } else if (elapsedS < 25) {
            subtitle.textContent = "Up and down now. Do not let go!";
        } else {
            subtitle.textContent = "HAHAHAHAHAHA";
        }

        // Move the button according to phase
        const pos = motionAt(elapsedS);
        setYesPosition(pos.x, pos.y);

        // Fail at 30s no matter what
        if (elapsedS >= 30) {
            failTrial1();
            return;
        }

        rafId = requestAnimationFrame(tickTrial1);
    }

    // Holding mechanics
    yesBtn.addEventListener("pointerdown", (e) => {
        e.preventDefault();
        yesBtn.setPointerCapture?.(e.pointerId);

        holding = true;
        holdStartMs = performance.now();
        yesBtn.classList.remove("smooth");

        const p = getYesPos();
        baseX = p.x;
        baseY = p.y;

        // Make it feel pressed
        yesBtn.style.transform = "scale(0.92)";

        if (navigator.vibrate) navigator.vibrate(20);

        cancelAnimationFrame(rafId);
        rafId = requestAnimationFrame(tickTrial1);
    });

    function endHold() {
        if (!holding) return;

        holding = false;
        cancelAnimationFrame(rafId);
        rafId = null;

        yesBtn.style.transform = "scale(1)";

        subtitle.textContent = "You let go. That is... tragic. Try again.";
        if (navigator.vibrate) navigator.vibrate([30, 40, 30]);

        // Reset progress + reposition to center
        progressBar.style.width = "0%";
        centerYesButton();
    }

    yesBtn.addEventListener("pointerup", () => endHold());
    yesBtn.addEventListener("pointercancel", () => endHold());
    yesBtn.addEventListener("lostpointercapture", () => endHold());

    yesBtn.addEventListener("click", () => {
        if (!trialEnded || holding || !nextTrialReady) return;
        startTrial1();
    });

    // Start
    startTrial1();
</script>
</body>
</html>
